generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
}

enum ConcertGenre {
  ROCK
  POP
  JAZZ
  ELECTRONIC
  HIP_HOP
  CLASSICAL
  METAL
  INDIE
  OTHER
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  email         String    @unique
  username      String
  image         String?
  password      String
  role          UserRole  @default(USER)
  
  // Relations
  favoriteGroups Group[]  @relation("UserFavoriteGroups", fields: [favoriteBands], references: [id])
  favoriteBands String[]  @db.ObjectId
  
  wishListConcerts Concert[] @relation("UserWishList", fields: [wishList], references: [id])
  wishList      String[]  @db.ObjectId
  
  tickets       Ticket[]
  verified      Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("users")
}

model Group {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  bio           String
  image         String?
  genre         ConcertGenre
  
  // Many-to-Many DIRECTE with Concert
  concerts      Concert[] @relation("GroupConcerts", fields: [concertIds], references: [id])
  concertIds    String[]  @db.ObjectId
  
  // Relation with fans
  fans          User[]    @relation("UserFavoriteGroups", fields: [fanIds], references: [id])
  fanIds        String[]  @db.ObjectId
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("groups")
}

model Concert {
  id              String        @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  description     String?
  genre           ConcertGenre
  
  // Many-to-Many Relation with Group
  groups          Group[]       @relation("GroupConcerts", fields: [groupIds], references: [id])
  groupIds        String[]      @db.ObjectId

  date            DateTime
  location        String
  image           String?
  totalSeats      Int
  availableSeats  Int
  price           Float
  
  // Relations
  tickets         Ticket[]
  inWishListOf    User[]        @relation("UserWishList", fields: [wishListUserIds], references: [id])
  wishListUserIds String[]      @db.ObjectId
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@map("concerts")
}

model Ticket {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  price       Float
  qrCode      String?
  status      String   @default("BOOKED")
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String   @db.ObjectId
  
  concert     Concert?  @relation(fields: [concertId], references: [id], onDelete: Cascade)
  concertId   String?   @db.ObjectId
  
  createdAt   DateTime @default(now())

  @@map("tickets")
}